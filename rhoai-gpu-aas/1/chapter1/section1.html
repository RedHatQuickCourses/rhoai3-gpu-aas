<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>The Efficiency Engine (Time-Slicing) :: GPU as a Service on Red Hat OpenShift AI 3.2</title>
    <link rel="prev" href="../index.html">
    <link rel="next" href="section2.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">GPU as a Service on Red Hat OpenShift AI 3.2</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/REPLACEREPONAME/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="rhoai-gpu-aas" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">GPU as a Service on Red Hat OpenShift AI 3.2</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="section1.html">Configuring Time-Slicing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="section2.html">Configuring MIG</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="section3.html">Validation &amp; Troubleshooting</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="section4.html">Governance &amp; Quotas</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="section5.html">Multi-GPU Aggregation</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">GPU as a Service on Red Hat OpenShift AI 3.2</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">GPU as a Service on Red Hat OpenShift AI 3.2</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">GPU as a Service on Red Hat OpenShift AI 3.2</a></li>
    <li><a href="section1.html">Configuring Time-Slicing</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">The Efficiency Engine (Time-Slicing)</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><strong>How to oversubscribe your hardware and solve the "No GPUs Available" crisis.</strong></p>
</div>
<div class="quoteblock abstract">
<blockquote>
Time-slicing is the quickest way to increase density in your cluster. By enabling software-level interleaving, you can allow multiple workloads to share a single GPU. This module guides you through the three-step configuration process: The Map, The Policy, and The Label.
</blockquote>
</div>
<div id="toc" class="toc">
<div id="toctitle" class="title">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_concept_the_gym_membership_model">Concept: The Gym Membership Model</a></li>
<li><a href="#_step_1_define_the_slicing_configuration">Step 1: Define the Slicing Configuration</a></li>
<li><a href="#_step_2_activate_the_configuration_in_clusterpolicy">Step 2: Activate the Configuration in ClusterPolicy</a></li>
<li><a href="#_step_3_verify_the_magic_node_capacity">Step 3: Verify the "Magic" (Node Capacity)</a></li>
<li><a href="#_step_4_the_hardware_profile">Step 4: The Hardware Profile</a></li>
<li><a href="#_lab_try_it_yourself">Lab: Try it Yourself</a></li>
<li><a href="#_next_steps">Next Steps</a></li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_concept_the_gym_membership_model"><a class="anchor" href="#_concept_the_gym_membership_model"></a>Concept: The Gym Membership Model</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Think of Time-Slicing like a gym. You might have 100 members but only 10 treadmills. It works because not everyone runs at the exact same second.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Without Time-Slicing:</strong> When a user opens a Jupyter Notebook, they "lock the door" to the gym. No one else can enter, even if the user is just reading documentation.</p>
</li>
<li>
<p><strong>With Time-Slicing:</strong> The door is unlocked. Multiple users can enter. The GPU (the treadmill) rapidly switches between them.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">The Safety Warning</div>
<div class="paragraph">
<p><strong>Shared Memory:</strong> Time-slicing provides <strong>compute</strong> isolation (via context switching) but <strong>not memory isolation</strong>. All users share the same VRAM pool.
* <strong>Risk:</strong> If User A runs a massive job that consumes 100% of the VRAM, User B&#8217;s process will crash (OOM).
* <strong>Mitigation:</strong> Use this strategy for Development, Notebooks, and Educationâ€”not for heavy production training.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_step_1_define_the_slicing_configuration"><a class="anchor" href="#_step_1_define_the_slicing_configuration"></a>Step 1: Define the Slicing Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>First, we tell the NVIDIA GPU Operator <strong>how</strong> to slice the cards. We do this with a <code>ConfigMap</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: time-slicing-config
  namespace: nvidia-gpu-operator
data:
  any: |-  <i class="conum" data-value="1"></i><b>(1)</b>
    version: v1
    sharing:
      timeSlicing:
        resources:
        - name: nvidia.com/gpu
          replicas: 4  <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><strong>The Config Key:</strong> We use <code>any</code> to apply this generic rule to any NVIDIA GPU. You can also use specific product names (e.g., <code>tesla-t4</code>, <code>a100</code>) to create different rules for different cards.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><strong>Replicas:</strong> This is the magic number. We are telling the driver to advertise 4 "virtual" GPUs for every 1 physical GPU.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_step_2_activate_the_configuration_in_clusterpolicy"><a class="anchor" href="#_step_2_activate_the_configuration_in_clusterpolicy"></a>Step 2: Activate the Configuration in ClusterPolicy</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Merely creating the ConfigMap does nothing. We must instruct the GPU Operator to read it.</p>
</div>
<div class="paragraph">
<p>We patch the <code>ClusterPolicy</code> to reference our new map.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: nvidia.com/v1
kind: ClusterPolicy
metadata:
  name: gpu-cluster-policy
spec:
  migStrategy: none  <i class="conum" data-value="1"></i><b>(1)</b>
  devicePlugin:
    config:
      name: time-slicing-config  <i class="conum" data-value="2"></i><b>(2)</b>
      default: any  <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><strong>Disable MIG:</strong> Time-slicing and MIG cannot usually coexist on the same node. We ensure MIG is off.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><strong>Reference:</strong> Points to the ConfigMap we created in Step 1.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><strong>Default Strategy:</strong> Tells the operator to apply the configuration keyed as <code>any</code> (from Step 1) to all GPUs unless specified otherwise.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_step_3_verify_the_magic_node_capacity"><a class="anchor" href="#_step_3_verify_the_magic_node_capacity"></a>Step 3: Verify the "Magic" (Node Capacity)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once the Operator processes the change, the Device Plugin will restart. You can verify the success by looking at the Node&#8217;s capacity.</p>
</div>
<div class="paragraph">
<p>Run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc describe node &lt;your-gpu-node&gt; | grep "nvidia.com/gpu"</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Output Comparison</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Before</th>
<th class="tableblock halign-left valign-top">After</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Capacity: <code>nvidia.com/gpu: 1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Capacity: <code>nvidia.com/gpu: 4</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allocatable: <code>nvidia.com/gpu: 1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allocatable: <code>nvidia.com/gpu: 4</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The node now claims to have 4 GPUs. Kubernetes doesn&#8217;t know they are fake; it just schedules pods until the counter hits 0.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_step_4_the_hardware_profile"><a class="anchor" href="#_step_4_the_hardware_profile"></a>Step 4: The Hardware Profile</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that the capacity exists, how do users consume it?</p>
</div>
<div class="paragraph">
<p>With Time-Slicing, the resource name remains <code>nvidia.com/gpu</code>. Therefore, you do <strong>not</strong> need a specialized identifier in your Hardware Profile. You simply create a profile for "Shared GPU".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: dashboard.opendatahub.io/v1alpha1
kind: HardwareProfile
metadata:
  name: nvidia-gpu-shared
  namespace: redhat-ods-applications # Global profile
spec:
  displayName: "NVIDIA GPU (Shared)"
  description: "Best for interactive workbooks and coding. Memory is shared with other users."
  identifiers:
    - identifier: nvidia.com/gpu
      count: 1  <i class="conum" data-value="1"></i><b>(1)</b>
  tolerations:
    - key: "nvidia.com/gpu"
      operator: "Exists"
      effect: "NoSchedule"</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><strong>The User Request:</strong> The user still asks for "1 GPU". But because the node now has 4 to give, 4 users can successfully launch this profile on the same node.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_try_it_yourself"><a class="anchor" href="#_lab_try_it_yourself"></a>Lab: Try it Yourself</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create the <code>time-slicing-config</code> ConfigMap.</p>
</li>
<li>
<p>Edit the <code>gpu-cluster-policy</code> to reference it.</p>
</li>
<li>
<p>Watch the pods in <code>nvidia-gpu-operator</code> namespace restart.</p>
</li>
<li>
<p>Verify <code>oc describe node</code> shows increased capacity.</p>
</li>
<li>
<p>Create two Notebooks using the "Shared" profile and verify they land on the same node.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_next_steps"><a class="anchor" href="#_next_steps"></a>Next Steps</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Time-slicing is great for density, but what if you need <strong>guaranteed performance</strong> and <strong>strict isolation</strong>?
Proceed to <strong>Module 3: Configuring MIG</strong> to learn the "Hard" partition strategy.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="../index.html">Home</a></span>
  <span class="next"><a href="section2.html">Configuring MIG</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
