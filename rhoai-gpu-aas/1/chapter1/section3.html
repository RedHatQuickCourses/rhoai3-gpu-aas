<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Lab: Enabling the Governance Layer (Control &amp; Demand) :: End the GPU Bottleneck, Automated Access at Scale</title>
    <link rel="prev" href="section2.html">
    <link rel="next" href="section4.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">End the GPU Bottleneck, Automated Access at Scale</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/REPLACEREPONAME/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="rhoai-gpu-aas" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">End the GPU Bottleneck, Automated Access at Scale</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="section1.html">Architecture Deep Dive</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="section2.html">Supply Lab: Time-Slicing</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="section3.html">Governance Lab: Kueue &amp; Profiles</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="section4.html">Aggregation Lab: Scaling Up</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">End the GPU Bottleneck, Automated Access at Scale</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">End the GPU Bottleneck, Automated Access at Scale</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">End the GPU Bottleneck, Automated Access at Scale</a></li>
    <li><a href="section3.html">Governance Lab: Kueue &amp; Profiles</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Lab: Enabling the Governance Layer (Control &amp; Demand)</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph lead">
<p><strong>Capacity without control is just chaos. We must now install the traffic controller.</strong></p>
</div>
<div class="paragraph">
<p>In the previous lab, you created 4x virtual GPUs per node. In this lab, you assume the role of the <strong>Platform Admin</strong>. Your objective is to expose these resources to users via a governed "Vending Machine."</p>
</div>
<div class="paragraph">
<p>We will configure <strong>Kueue</strong> to manage the quota and deploy a <strong>Hardware Profile</strong> that allows users to request these slices without knowing the underlying complexity.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_prerequisites"><a class="anchor" href="#_prerequisites"></a>Prerequisites</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><strong>Supply:</strong> You have completed Section 2 (Nodes are advertising <code>nvidia.com/gpu: 4</code>).</p>
</li>
<li>
<p><strong>Kueue:</strong> The Kueue Operator is installed and set to <code>Managed</code> or <code>Unmanaged</code>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_step_1_initialize_the_traffic_controller_day_0_config"><a class="anchor" href="#_step_1_initialize_the_traffic_controller_day_0_config"></a>Step 1: Initialize the Traffic Controller (Day 0 Config)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, the RHOAI Dashboard hides the complex queuing options. We must enable them.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Enable Dashboard Queue UI:</strong></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc patch odhdashboardconfig odh-dashboard-config -n redhat-ods-applications \
  --type=merge -p '{"spec":{"disableKueue": false}}'</code></pre>
</div>
</div>
</li>
<li>
<p><strong>Invite the Namespace:</strong>
Kueue only manages projects that are explicitly "invited." Label your target user namespace (e.g., <code>gpu-users</code>).</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc new-project gpu-users
oc label namespace gpu-users kueue.openshift.io/managed=true</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_step_2_define_the_physical_flavor_resourceflavor"><a class="anchor" href="#_step_2_define_the_physical_flavor_resourceflavor"></a>Step 2: Define the Physical Flavor (ResourceFlavor)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Kueue needs to know what "Standard GPU" actually means in terms of physical labels.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Create the ResourceFlavor:</strong>
This object tells Kueue: "When I ask for 'default-flavor', I mean nodes with the label <code>nvidia.com/gpu</code>."</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kueue.x-k8s.io/v1beta1
kind: ResourceFlavor
metadata:
  name: default-flavor
spec:
  nodeLabels:
    nvidia.com/gpu.product: NVIDIA-L40S # &lt;1&gt; Optional: Pin to specific hardware
  tolerations:
  - key: "nvidia.com/gpu"
    operator: "Exists"</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_step_3_set_the_quota_clusterqueue"><a class="anchor" href="#_step_3_set_the_quota_clusterqueue"></a>Step 3: Set the Quota (ClusterQueue)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now we define the limits. We will create a global queue that allows the cluster to consume the virtual slices we created.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Create the ClusterQueue:</strong></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kueue.x-k8s.io/v1beta1
kind: ClusterQueue
metadata:
  name: cluster-queue-gpu
spec:
  namespaceSelector: {} # &lt;1&gt; Open to all namespaces
  resourceGroups:
  - coveredResources: ["nvidia.com/gpu"]
    flavors:
    - name: default-flavor
      resources:
      - name: "nvidia.com/gpu"
        nominalQuota: 10 # &lt;2&gt; Guaranteed slots
        borrowingLimit: 10 # &lt;3&gt; Extra burstable slots</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_step_4_build_the_bridge_localqueue"><a class="anchor" href="#_step_4_build_the_bridge_localqueue"></a>Step 4: Build the Bridge (LocalQueue)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Users cannot see the global ClusterQueue. We must create a "Local Queue" inside their project that connects to the main supply.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Create the LocalQueue:</strong></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kueue.x-k8s.io/v1beta1
kind: LocalQueue
metadata:
  namespace: gpu-users
  name: local-queue-gpu
spec:
  clusterQueue: cluster-queue-gpu</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_step_5_publish_the_menu_hardware_profile"><a class="anchor" href="#_step_5_publish_the_menu_hardware_profile"></a>Step 5: Publish the Menu (Hardware Profile)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Finally, we create the UI button.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Critical Architecture Note</div>
<div class="paragraph">
<p>Because we are using Kueue, this Hardware Profile <strong>must not</strong> contain <code>nodeSelectors</code> or <code>tolerations</code>. It serves only as a pointer to the queue.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Create the Hardware Profile:</strong></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: dashboard.opendatahub.io/v1alpha1
kind: HardwareProfile
metadata:
  name: profile-l40s-slice
  namespace: redhat-ods-applications
spec:
  displayName: "NVIDIA L40S (Time-Sliced)"
  description: "Shared GPU segment. Good for inference and light training."
  identifiers:
    - identifier: nvidia.com/gpu
      count: 1
  # No selectors here. Kueue handles placement.</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_step_6_the_payoff_verification"><a class="anchor" href="#_step_6_the_payoff_verification"></a>Step 6: The "Payoff" (Verification)</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in to the RHOAI Dashboard.</p>
</li>
<li>
<p>Go to <strong>Data Science Projects</strong> &#8594; <strong>gpu-users</strong>.</p>
</li>
<li>
<p>Create a Workbench.</p>
</li>
<li>
<p>Select the <strong>"NVIDIA L40S (Time-Sliced)"</strong> accelerator.</p>
</li>
<li>
<p><strong>Success:</strong> The Pod launches.</p>
<div class="ulist">
<ul>
<li>
<p><strong>Under the hood:</strong> Kueue intercepted the request, checked the quota in <code>cluster-queue-gpu</code>, assigned <code>default-flavor</code>, and the Scheduler placed it on one of your 4 virtual slices.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<hr>
<div class="paragraph">
<p><strong>Mission Accomplished. You have successfully deployed an end-to-end GPU-as-a-Service architecture.</strong></p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="section2.html">Supply Lab: Time-Slicing</a></span>
  <span class="next"><a href="section4.html">Aggregation Lab: Scaling Up</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
